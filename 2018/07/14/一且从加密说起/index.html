<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>一切从加密说起 | hello2dj | if you can&#39;t explain it simply, you don&#39;t understand it well enough</title>

  
  <meta name="author" content="hello2dj (dj_amazing@sina.com)">
  

  
  <meta name="description" content="每个人都是带着棱角来到世上，只有磨平棱角才能走的更远">
  

  
  
  <meta name="keywords" content="crypto,ssl/tsl">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="一切从加密说起"/>

  <meta property="og:site_name" content="hello2dj"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="hello2dj" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">hello2dj</a>
    </h1>
    <p class="site-description">if you can&#39;t explain it simply, you don&#39;t understand it well enough</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/categories">Categories</a></li>
      
        <li><a href="/tags">Tags</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>一切从加密说起</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/14/一且从加密说起/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-14T13:00:30.099Z">
          2018-07-14
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><img src="https://documents.trendmicro.com/images/TEx/articles/encryption1.jpg" alt="加密"></p>
<h3 id="我们为什么需要加密"><a href="#我们为什么需要加密" class="headerlink" title="我们为什么需要加密"></a><a href="https://www.schneier.com/blog/archives/2015/06/why_we_encrypt.html" target="_blank" rel="noopener">我们为什么需要加密</a></h3><ul>
<li><h5 id="加密可以保护我们的数据。无论数据是正存放在我们自己的计算机上，还是位于数据中心，或者正在通过互联网传送的途中，加密都可以提供防护。加密可以保护我们的聊天，不管是视频、语音还是文字。加密可以保护我们的隐私，可以隐藏我们的踪迹，甚至有时候，它会保护我们的性命。这种保护是攸关我们每个人的。"><a href="#加密可以保护我们的数据。无论数据是正存放在我们自己的计算机上，还是位于数据中心，或者正在通过互联网传送的途中，加密都可以提供防护。加密可以保护我们的聊天，不管是视频、语音还是文字。加密可以保护我们的隐私，可以隐藏我们的踪迹，甚至有时候，它会保护我们的性命。这种保护是攸关我们每个人的。" class="headerlink" title="加密可以保护我们的数据。无论数据是正存放在我们自己的计算机上，还是位于数据中心，或者正在通过互联网传送的途中，加密都可以提供防护。加密可以保护我们的聊天，不管是视频、语音还是文字。加密可以保护我们的隐私，可以隐藏我们的踪迹，甚至有时候，它会保护我们的性命。这种保护是攸关我们每个人的。"></a>加密可以保护我们的数据。无论数据是正存放在我们自己的计算机上，还是位于数据中心，或者正在通过互联网传送的途中，加密都可以提供防护。加密可以保护我们的聊天，不管是视频、语音还是文字。加密可以保护我们的隐私，可以隐藏我们的踪迹，甚至有时候，它会保护我们的性命。这种保护是攸关我们每个人的。</h5></li>
<li><h3 id="加密是我们所拥有的最强力的隐私保护技术，是唯一适合避免大规模监视。"><a href="#加密是我们所拥有的最强力的隐私保护技术，是唯一适合避免大规模监视。" class="headerlink" title="加密是我们所拥有的最强力的隐私保护技术，是唯一适合避免大规模监视。"></a>加密是我们所拥有的最强力的隐私保护技术，是唯一适合避免大规模监视。</h3></li>
<li><h3 id="避免犯罪分子撒网寻找可乘之机——的技术。"><a href="#避免犯罪分子撒网寻找可乘之机——的技术。" class="headerlink" title="避免犯罪分子撒网寻找可乘之机——的技术。"></a>避免犯罪分子撒网寻找可乘之机——的技术。</h3></li>
<li><h3 id="通过使用加密迫使双方都只能专注于具体的个体目标，我们也保护了这个社会。"><a href="#通过使用加密迫使双方都只能专注于具体的个体目标，我们也保护了这个社会。" class="headerlink" title="通过使用加密迫使双方都只能专注于具体的个体目标，我们也保护了这个社会。"></a>通过使用加密迫使双方都只能专注于具体的个体目标，我们也保护了这个社会。</h3></li>
</ul>
<h3 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h3><ul>
<li><h4 id="对称加密-加密者和解密者用的秘钥都是一样的"><a href="#对称加密-加密者和解密者用的秘钥都是一样的" class="headerlink" title="对称加密(加密者和解密者用的秘钥都是一样的)"></a>对称加密(加密者和解密者用的秘钥都是一样的)</h4><ul>
<li><h4 id="常见的对称加密算法有-DES、3DES、AES、Blowfish、IDEA、RC5、RC6"><a href="#常见的对称加密算法有-DES、3DES、AES、Blowfish、IDEA、RC5、RC6" class="headerlink" title="常见的对称加密算法有 DES、3DES、AES、Blowfish、IDEA、RC5、RC6"></a>常见的对称加密算法有 DES、3DES、AES、Blowfish、IDEA、RC5、RC6</h4></li>
<li>举个简单例子，我把我的数据块切分成 32 位大小的，然后都和我的秘钥 key(32 位)进行异或，在相加，这就是个简单的对称加密了。。。有了我的 key 就可以解开了，在异或一次我的 key 就解开了</li>
<li><h4 id="举个例子-AES-的模式，有-128，256-bit-的，接下来是加密模式"><a href="#举个例子-AES-的模式，有-128，256-bit-的，接下来是加密模式" class="headerlink" title="举个例子 AES 的模式，有 128，256 bit 的，接下来是加密模式"></a>举个例子 AES 的模式，有 128，256 bit 的，接下来是加密模式</h4>ECB：是一种基础的加密方式，密文被分割成分组长度相等的块（不足补齐），然后单独一个个加密，一个个输出组成密文。<br>CBC：是一种循环模式，前一个分组的密文和当前分组的明文异或操作后再加密，这样做的目的是增强破解难度。<br>CFB/OFB 实际上是一种反馈模式，目的也是增强破解的难度。还有填充方式，cbc 是需要填充的， cbc 还需要 iv, 初始化向量</li>
</ul>
<blockquote>
<p>ECB 和 CBC 的加密结果是不一样的，两者的模式不同，而且 CBC 会在第一个密码块运算时加入一个初始化向量。</p>
</blockquote>
</li>
<li><h4 id="非对称加密-加密者和解密者使用的-key-是不同，就说加密者使用-key1-加密，解谜者使用-key2-解密"><a href="#非对称加密-加密者和解密者使用的-key-是不同，就说加密者使用-key1-加密，解谜者使用-key2-解密" class="headerlink" title="非对称加密(加密者和解密者使用的 key 是不同，就说加密者使用 key1 加密，解谜者使用 key2 解密)"></a>非对称加密(加密者和解密者使用的 key 是不同，就说加密者使用 key1 加密，解谜者使用 key2 解密)</h4><ol>
<li><p>非对称加密算法 RSA、ECC（移动设备用）、Diffie-Hellman、El Gamal、DSA（数字签名用），有个公钥和私钥，公钥加密的数据只有对应的私钥能解开，而私钥加密的数据就只有公钥能解开了 (<a href="http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html" target="_blank" rel="noopener">rsa 原理</a>),被破解的难度在于大整数的因式分解困难, rsa 的加密明文是必须小于 key 的 <a href="http://www.metsky.com/archives/657.html" target="_blank" rel="noopener">明文，密文长度</a>而密文长度是和密钥长度是一致的。</p>
</li>
<li><p>安全性 ECDH &gt; DHE &gt; RSA,DH, 前两者提供前向安全: 前向安全: 用来产生会话密钥(session key)的长期密钥(long-term key)泄露出去，不会造成之前通讯时使用的会话密钥(session key)的泄露，也就不会暴漏以前的通讯内容。简单的说，当你丢了这个 long-term key 之后，你以后的行为的安全性无法保证，但是你之前的行为是保证安全的</p>
</li>
<li><p>rsa 加密时注意项, 跟 DES，AES 一样，RSA 也是一个块加密算法（ block cipher algorithm），总是在一个固定长度的块上进行操作。 当明文长度不够加密的长度时需要补足, 因为一次加密的长度是有固定的，为什么是固定的请看 rsa 原理篇</p>
</li>
</ol>
</li>
</ul>
<pre><code>RSA 加密常用的填充方式有下面 3 种：

1.  RSA_PKCS1_PADDING 填充模式，最常用的模式，当你选择 RSA_PKCS1_PADDING 填充模式时，如果你的明文不够 128 字节， 加密的时候会在你的明文中随机填充一些数据，所以会导致对同样的明文每次加密后的结果都不一样。对加密后的密文，服务器使用相同的填充方式都能解密。解密后的明文也就是之前加密的明文。


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">要求:</span><br><span class="line">输入：必须 比 RSA 钥模长(modulus) 短至少11个字节, 也就是　RSA_size(rsa) – 11</span><br><span class="line">如果输入的明文过长，必须切割，　然后填充</span><br><span class="line"></span><br><span class="line">输出：和modulus一样长</span><br><span class="line"></span><br><span class="line">根据这个要求，对于512bit的密钥，　block length = 512/8 – 11 = 53 字节</span><br></pre></td></tr></table></figure>

2.  for RSA_NO_PADDING 　　不填充，当你在客户端选择 RSA_NO_PADDING 填充模式时，如果你的明文不够 128 字节， 加密的时候会在你的明文前面，前向的填充零。解密后的明文也会包括前面填充的零，这是服务器需要注意把解密后的字段前向填充的零去掉，才是真正之前加密的明文


  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">输入：可以和RSA钥模长一样长，如果输入的明文过长，必须切割，　然后填充</span><br><span class="line"></span><br><span class="line">输出：和modulus一样长</span><br><span class="line"></span><br><span class="line">但跟AES等不同的是，　block length是跟key length有关的。</span><br><span class="line"></span><br><span class="line">每次RSA加密的明文的长度是受RSA填充模式限制的，但是RSA每次加密的块长度就是key length。</span><br></pre></td></tr></table></figure>

3.  RSA_PKCS1_OAEP_PADDING，RSA_PKCS1_OAEP_PADDING 填充模式没有使用过， 他是 PKCS#1 推出的新的填充方式，安全性是最高的，和前面 RSA_PKCS1_PADDING 的区别就是加密前的编码方式不一样

  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：RSA_size(rsa) – 41</span><br><span class="line"></span><br><span class="line">输出：和modulus一样长</span><br></pre></td></tr></table></figure>

一句话不同的填充方式加解密也是不同的，使用的时候要注意
</code></pre><h3 id="ssl-tls-的加密流程"><a href="#ssl-tls-的加密流程" class="headerlink" title="ssl/tls 的加密流程"></a>ssl/tls 的加密流程</h3><p><a href="http://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html" target="_blank" rel="noopener">详见</a></p>
<h3 id="数字证书"><a href="#数字证书" class="headerlink" title="数字证书"></a>数字证书</h3><ul>
<li><h4 id="数字证书和数字签名的原理"><a href="#数字证书和数字签名的原理" class="headerlink" title="数字证书和数字签名的原理"></a><a href="http://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html" target="_blank" rel="noopener">数字证书和数字签名的原理</a></h4>简单来说数字签名就是传输信息的摘要，数字证书就是 CA 用自己的私钥把你的公钥及其他信息加密后生成内容, 即 CA 用自己的私钥来给你的公钥做数字签名</li>
<li><h4 id="现在的数字证书一般采用证书的格式遵循-ITUT-X-509-国际标准。一个标准的-X-509-数字证书包含以下一些内容"><a href="#现在的数字证书一般采用证书的格式遵循-ITUT-X-509-国际标准。一个标准的-X-509-数字证书包含以下一些内容" class="headerlink" title="现在的数字证书一般采用证书的格式遵循 ITUT X.509 国际标准。一个标准的 X.509 数字证书包含以下一些内容"></a>现在的数字证书一般采用证书的格式遵循 ITUT X.509 国际标准。一个标准的 X.509 数字证书包含以下一些内容</h4><ol>
<li>证书的版本信息;</li>
<li>证书的序列号，每个证书都有一个唯一的证书序列号;</li>
<li>证书所使用的签名算法;</li>
<li>证书的发行机构名称，命名规则一般采用 X.500 格式;</li>
<li>证书的有效期，现在通用的证书一般采用 UTC 时间格式，它的计时范围为 1950-2049;</li>
<li>证书所有人的名称，命名规则一般采用 X.500 格式;</li>
<li>证书所有人的公开密钥;</li>
<li>证书发行者对证书的签名。</li>
</ol>
<ul>
<li><h4 id="证书格式"><a href="#证书格式" class="headerlink" title="证书格式"></a>证书格式</h4><ul>
<li><h5 id="PEM-格式"><a href="#PEM-格式" class="headerlink" title="PEM 格式"></a>PEM 格式</h5><p>PEM 格式通常用于数字证书认证机构（Certificate Authorities，CA），扩展名为.pem, .crt, .cer, and .key。内容为 Base64 编码的 ASCII 码文件，有类似”—–BEGIN CERTIFICATE—–” 和 “—–END CERTIFICATE—–”的头尾标记。服务器认证证书，中级认证证书和私钥都可以储存为 PEM 格式（认证证书其实就是公钥）。Apache 和类似的服务器使用 PEM 格式证书。</p>
</li>
<li><h5 id="DER-格式"><a href="#DER-格式" class="headerlink" title="DER 格式"></a>DER 格式</h5><p>DER 格式与 PEM 不同之处在于其使用二进制而不是 Base64 编码的 ASCII。扩展名为.der，但也经常使用.cer 用作扩展名，所有类型的认证证书和私钥都可以存储为 DER 格式。Java 是其典型使用平台。</p>
</li>
<li><h5 id="PKCS-7-P7B-格式"><a href="#PKCS-7-P7B-格式" class="headerlink" title="PKCS#7/P7B 格式"></a>PKCS#7/P7B 格式</h5><p>PKCS#7 或 P7B 格式通常以 Base64 的格式存储，扩展名为.p7b 或 .p7c，有类似 BEGIN PKCS7—–” 和 “—–END PKCS7—–”的头尾标记。PKCS#7 或 P7B 只能存储认证证书或证书路径中的证书（就是存储认证证书链，本级，上级，到根级都存到一个文件中）。不能存储私钥，Windows 和 Tomcat 都支持这种格式。</p>
</li>
<li><h5 id="PKCS-12-PFX-格式"><a href="#PKCS-12-PFX-格式" class="headerlink" title="PKCS#12/PFX 格式"></a>PKCS#12/PFX 格式</h5><p>PKCS#12 或 PFX 格式是以加密的二进制形式存储服务器认证证书，中级认证证书和私钥。扩展名为.pfx 和 .p12，PXF 通常用于 Windows 中导入导出认证证书和私钥。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>X.509 证书标准支持三种不对称加密算法：RSA, DSA, Diffie-Hellman algorithms。最常用的是 RSA 算法</p>
</li>
<li><p>数字签名的作用</p>
<ol>
<li>是能确定消息的不可抵赖性，因为他人假冒不了发送方的私钥签名。发送方是用自己的私钥对信息进行加密的，只有使用发送方的公钥才能解密。</li>
<li>是数字签名能保障消息的完整性。一次数字签名采用一个特定的哈希函数，它对不同文件产生的数字摘要的值也是不相同的</li>
</ol>
</li>
<li>数字证书的作用<ol>
<li>不可抵赖性</li>
<li>消息的完整性</li>
<li>身份认证</li>
</ol>
</li>
</ul>
<h3 id="CA-数字证书认证机构（英语：Certificate-Authority，缩写为-CA）"><a href="#CA-数字证书认证机构（英语：Certificate-Authority，缩写为-CA）" class="headerlink" title="CA 数字证书认证机构（英语：Certificate Authority，缩写为 CA）"></a>CA 数字证书认证机构（英语：Certificate Authority，缩写为 CA）</h3><ul>
<li>负责发放和管理数字证书的权威机构，承担公钥体系中公钥的合法性检验的责任。</li>
<li>CA 是证书的签发机构，它是 PKI 的核心。CA 是负责签发证书、认证证书、管理已颁发证书的机关。它要制定政策和具体步骤来验证、识别用户身份，并对用户证书进行签名，以确保证书持有者的身份和公钥的拥有权。</li>
<li>CA 也拥有一个证书（内含公钥）和私钥。网上的公众用户通过验证 CA 的签字从而信任 CA ，任何人都可以得到 CA 的证书（含公钥），用以验证它所签发的证书。</li>
<li>如果用户想得到一份属于自己的证书，他应先向 CA 提出申请。在 CA 判明申请者的身份后，便为他分配一个公钥，并且 CA 将该公钥与申请者的身份信息绑在一起，并为之签字后，便形成证书发给申请者。</li>
<li>如果一个用户想鉴别另一个证书的真伪，他就用 CA 的公钥对那个证书上的签字进行验证，一旦验证通过，该证书就被认为是有效的</li>
</ul>
<h3 id="公钥基础设施（Public-Key-Infrastructure，简称-PKI）"><a href="#公钥基础设施（Public-Key-Infrastructure，简称-PKI）" class="headerlink" title="公钥基础设施（Public Key Infrastructure，简称 PKI）"></a>公钥基础设施（Public Key Infrastructure，简称 PKI）</h3><p><a href="https://zh.wikipedia.org/wiki/%E5%85%AC%E9%96%8B%E9%87%91%E9%91%B0%E5%9F%BA%E7%A4%8E%E5%BB%BA%E8%A8%AD" target="_blank" rel="noopener">wiki</a></p>
<p>参考:</p>
<ol>
<li><a href="https://segmentfault.com/a/1190000007283514" target="_blank" rel="noopener">tsl/ssl 进阶</a></li>
<li><a href="http://www.cnblogs.com/fishou/p/4206451.html" target="_blank" rel="noopener">ecdh, dh</a></li>
<li><a href="http://blog.csdn.net/hherima/article/details/52469488" target="_blank" rel="noopener">pki 体系</a></li>
<li><a href="http://www.jianshu.com/p/46e48bc517d0" target="_blank" rel="noopener">ca 证书链</a></li>
</ol>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/crypto/">crypto</a><a href="/tags/ssl-tsl/">ssl/tsl</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 hello2dj (dj_amazing@sina.com)
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>